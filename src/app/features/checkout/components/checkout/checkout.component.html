<div class="checkout-container">
  <h1>Checkout</h1>
  <div *ngIf="loading" class="loading-spinner">
    <mat-spinner></mat-spinner>
  </div>
  <div *ngIf="error" class="error-message">
    <p>{{ error }}</p>
    <button mat-raised-button color="primary" (click)="retryLoading()">Retry</button>
  </div>
  <div *ngIf="!loading && !error" class="checkout-content">
    <div class="checkout-form">
      <h2>Checkout</h2>

      <form [formGroup]="checkoutForm" (ngSubmit)="onSubmit()">
        <div class="form-section">
          <h3>Contact Information</h3>
          <div class="form-row">
            <mat-form-field appearance="outline">
              <mat-label>First Name</mat-label>
              <input matInput formControlName="firstName" required>
              <mat-error *ngIf="checkoutForm.get('firstName')?.hasError('required')">
                First name is required
              </mat-error>
            </mat-form-field>

            <mat-form-field appearance="outline">
              <mat-label>Last Name</mat-label>
              <input matInput formControlName="lastName" required>
              <mat-error *ngIf="checkoutForm.get('lastName')?.hasError('required')">
                Last name is required
              </mat-error>
            </mat-form-field>
          </div>

          <div class="form-row">
            <mat-form-field appearance="outline">
              <mat-label>Email</mat-label>
              <input matInput formControlName="email" type="email" required>
              <mat-error *ngIf="checkoutForm.get('email')?.hasError('required')">
                Email is required
              </mat-error>
              <mat-error *ngIf="checkoutForm.get('email')?.hasError('email')">
                Please enter a valid email address
              </mat-error>
            </mat-form-field>

            <mat-form-field appearance="outline">
              <mat-label>Phone</mat-label>
              <input matInput formControlName="phone" required>
              <mat-error *ngIf="checkoutForm.get('phone')?.hasError('required')">
                Phone number is required
              </mat-error>
            </mat-form-field>
          </div>
        </div>

        <div class="form-section">
          <h3>Shipping Address</h3>
          <div class="form-row">
            <mat-form-field appearance="outline" class="full-width">
              <mat-label>Street Address</mat-label>
              <input matInput formControlName="address" required>
              <mat-error *ngIf="checkoutForm.get('address')?.hasError('required')">
                Street address is required
              </mat-error>
            </mat-form-field>
          </div>

          <div class="form-row">
            <mat-form-field appearance="outline">
              <mat-label>City</mat-label>
              <input matInput formControlName="city" required>
              <mat-error *ngIf="checkoutForm.get('city')?.hasError('required')">
                City is required
              </mat-error>
            </mat-form-field>

            <mat-form-field appearance="outline">
              <mat-label>State</mat-label>
              <input matInput formControlName="state" required>
              <mat-error *ngIf="checkoutForm.get('state')?.hasError('required')">
                State is required
              </mat-error>
            </mat-form-field>

            <mat-form-field appearance="outline">
              <mat-label>ZIP Code</mat-label>
              <input matInput formControlName="zipCode" required>
              <mat-error *ngIf="checkoutForm.get('zipCode')?.hasError('required')">
                ZIP code is required
              </mat-error>
            </mat-form-field>
          </div>

          <div class="form-row">
            <mat-form-field appearance="outline">
              <mat-label>Country</mat-label>
              <input matInput formControlName="country" value="US" readonly>
            </mat-form-field>
          </div>
        </div>

        <div class="form-section">
          <h3>Payment Method</h3>
          <div class="payment-methods" *ngIf="paymentMethods.length > 0">
            <mat-radio-group formControlName="paymentMethod" (change)="onPaymentMethodChange($event.value)">
              <mat-radio-button *ngFor="let method of paymentMethods" [value]="method.id" class="payment-method">
                <div class="payment-method-details">
                  <span class="card-brand">{{ method.brand }}</span>
                  <span class="card-last4">•••• {{ method.last4 }}</span>
                  <span class="card-expiry">Expires {{ method.expiryMonth }}/{{ method.expiryYear }}</span>
                  <span class="card-name">{{ method.name }}</span>
                  <span class="card-default" *ngIf="method.isDefault">Default</span>
                </div>
              </mat-radio-button>
            </mat-radio-group>
          </div>

          <div class="add-payment-method">
            <button mat-button color="primary" (click)="showAddPaymentMethod()">
              <mat-icon>add</mat-icon>
              Add New Payment Method
            </button>
          </div>
        </div>

        <div class="form-actions">
          <button mat-raised-button color="primary" type="submit" [disabled]="loading || checkoutForm.invalid || !selectedPaymentMethod">
            <mat-spinner diameter="20" *ngIf="loading"></mat-spinner>
            <span *ngIf="!loading">Place Order</span>
          </button>
        </div>
      </form>
    </div>

    <div class="order-summary">
      <h3>Order Summary</h3>
      <div class="cart-items">
        <div class="cart-item" *ngFor="let item of cartItems">
          <img [src]="item.artwork.imageUrl" [alt]="item.artwork.title" class="item-image">
          <div class="item-details">
            <h4>{{ item.artwork.title }}</h4>
            <p class="item-price">${{ item.artwork.price.toFixed(2) }}</p>
            <p class="item-quantity">Quantity: {{ item.quantity }}</p>
          </div>
        </div>
      </div>

      <div class="order-total">
        <div class="total-row">
          <span>Subtotal</span>
          <span>${{ cartTotal.toFixed(2) }}</span>
        </div>
        <div class="total-row">
          <span>Shipping</span>
          <span>Free</span>
        </div>
        <div class="total-row grand-total">
          <span>Total</span>
          <span>${{ cartTotal.toFixed(2) }}</span>
        </div>
      </div>
    </div>
  </div>
</div> 